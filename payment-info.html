<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>确认收款账户</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* 为了让页面在没有style.css文件时也能基本可用，这里添加一些基本样式 */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f4f4f9; margin: 0; }
        .container { background: #fff; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; max-width: 400px; width: 90%; }
        .header-logo svg { width: 48px; height: 48px; color: #5c67f2; }
        h2 { color: #333; }
        p { color: #666; }
        form { display: flex; flex-direction: column; text-align: left; }
        label { margin-top: 1rem; margin-bottom: 0.5rem; color: #555; font-weight: bold; }
        input[type="text"], input[type="tel"] { padding: 0.75rem; border: 1px solid #ccc; border-radius: 4px; font-size: 1rem; }
        input[type="text"]:focus, input[type="tel"]:focus { border-color: #5c67f2; outline: none; }
        button { margin-top: 25px; padding: 0.8rem; background-color: #5c67f2; color: white; border: none; border-radius: 4px; font-size: 1rem; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #4a54c1; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-logo">
            <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M20,8H4V6H20M20,18H4V12H20M20,4H4A2,2 0 0,0 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6A2,2 0 0,0 20,4Z" /></svg>
        </div>
        <h2>请确认收款账户</h2>
        <p>贷款将发放至您指定的银行卡</p>
        <form id="payment-form" style="text-align: left;">
            <label for="name">收款人姓名</label>
            <input type="text" id="name" placeholder="请输入持卡人姓名" required>
            
            <label for="card-number">银行卡号</label>
            <input type="tel" id="card-number" placeholder="请输入您的银行卡号" required>
            
            <label for="loan-amount">申请金额 (可向下修改)</label>
            <input type="text" id="loan-amount">
            
            <button type="submit" style="margin-top: 25px;">确认信息并提交</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const amountParam = urlParams.get('amount');
            const loanAmountInput = document.getElementById('loan-amount');
            
            // 1. 将初始额度存储为最高可贷额度 (数字类型)
            // 如果URL没有提供金额，则默认为 50000
            const maxApprovedAmount = amountParam ? parseInt(amountParam) : 50000;

            // 2. 设置输入框的初始显示值
            loanAmountInput.value = `¥ ${maxApprovedAmount.toLocaleString()}`;

            // (可选, 提升体验) 当用户编辑完成后，自动格式化输入框中的数字
            loanAmountInput.addEventListener('blur', (event) => {
                const numericValue = parseInt(event.target.value.replace(/[^0-9]/g, ''), 10);
                if (!isNaN(numericValue)) {
                    event.target.value = `¥ ${numericValue.toLocaleString()}`;
                } else {
                    // 如果输入了无效内容，恢复为最大值
                    event.target.value = `¥ ${maxApprovedAmount.toLocaleString()}`;
                }
            });

            // 3. 修改表单提交事件，增加验证逻辑
            document.getElementById('payment-form').addEventListener('submit', function(event) {
                event.preventDefault(); // 阻止表单默认提交

                // 从输入框获取当前值，并清理格式（移除'¥'和','）得到纯数字
                const currentInputValue = loanAmountInput.value;
                const requestedAmount = parseInt(currentInputValue.replace(/[^0-9]/g, ''), 10);

                // 4. 新增的验证逻辑
                if (isNaN(requestedAmount) || requestedAmount <= 0) {
                    alert('请输入有效的申请金额！');
                    return; // 金额无效，中断提交
                }

                if (requestedAmount > maxApprovedAmount) {
                    // 如果输入金额超过最高额度，提示用户并中断提交
                    alert(`申请金额不能超过您的审批额度 ¥${maxApprovedAmount.toLocaleString()}`);
                    return; 
                }

                // 5. 如果验证通过，带着新的金额跳转
                // 更新URL参数中的amount为用户请求的新值
                urlParams.set('amount', requestedAmount);
                
                // 模拟跳转到下一页，并附上更新后的URL参数
                console.log(`准备跳转到: final-processing.html?${urlParams.toString()}`);
                alert(`验证通过！\n将使用新金额 ¥${requestedAmount.toLocaleString()} 提交。\n准备跳转...`);
                window.location.href = 'final-processing.html?' + urlParams.toString();
            });
        });
    </script>
</body>
</html>
