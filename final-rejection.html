<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>申请失败</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container" style="padding-top: 50px; padding-bottom: 50px;">
        <div class="rejection-icon">
            <div class="line line1"></div>
            <div class="line line2"></div>
        </div>
        <h2 style="margin-top: 30px; color: #dc3545;">申请失败</h2>
        <p id="rejection-reason" style="font-size: 16px; color: #666; max-width: 280px; margin: 15px auto;"></p>
    </div>

    <script>
        // --- 脚本1：显示拒绝原因 (不变) ---
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const reasonBase64 = urlParams.get('reason_b64');
            const reasonElement = document.getElementById('rejection-reason');

            if (reasonBase64) {
                try {
                    const decodedReason = decodeURIComponent(escape(window.atob(reasonBase64)));
                    reasonElement.textContent = decodedReason;
                } catch (e) {
                    console.error("Base64解码失败:", e);
                    reasonElement.textContent = '无法加载失败原因（解码错误）。';
                }
            } else {
                reasonElement.textContent = '该账户存在异常风险，请联系客户经理。';
            }
        });

        // --- 脚本2：最终的锁定后退按钮脚本 ---
        (function() {
            // 确保脚本在页面完全加载后执行
            if (window.history && window.history.pushState) {
                // 当页面加载时，我们先将当前的历史记录替换掉，
                // 这样做是为了防止用户通过多次快速后退跳出我们的“陷阱”
                history.replaceState(null, '', location.href);

                // 然后，我们再推入一个新的、和当前页一模一样的历史记录
                // 这样历史记录栈就变成了 [..., 拒绝页, 拒绝页]
                history.pushState(null, '', location.href);

                // 监听后退事件
                window.addEventListener('popstate', function() {
                    // 当用户点击后退，会从第二个“拒绝页”回到第一个“拒绝页”，
                    // 此时popstate事件触发，我们立即再推入一个新的记录。
                    // 这样无论用户点多少次后退，都始终被我们推回到栈顶，实现锁定。
                    history.pushState(null, '', location.href);
                });
            }
        }());
    </script>
</body>
</html>
